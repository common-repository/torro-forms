/*!
 * Torro Forms Version 1.0.8 (https://torro-forms.com)
 * Licensed under GNU General Public License v2 (or later) (http://www.gnu.org/licenses/gpl-2.0.html)
 */
window.torro=window.torro||{},function(e,t,i,n){"use strict";function s(e){a++,r["builder"+a]=[],this.instanceNumber=a,this.$el=t(e)}var o,a=0,l=[],r={};i.extend(s.prototype,{elementTypes:void 0,form:void 0,formView:void 0,init:function(){return this.$el.length?void e.api.init().done(i.bind(function(){(new e.api.collections.ElementTypes).fetch({data:{context:"edit"},context:this,success:function(s){this.elementTypes=e.Builder.ElementTypes.fromApiCollection(s),"auto-draft"!==t("#original_post_status").val()?new e.api.models.Form({id:parseInt(t("#post_ID").val(),10)}).fetch({data:{context:"edit",_embed:!0},context:this,success:function(e){t(document).ready(i.bind(function(){var t;l.push(this.instanceCount),this.setupInitialData(e.attributes),this.setupViews();for(t in r["builder"+this.instanceCount])r["builder"+this.instanceCount][t](this);delete r["builder"+this.instanceCount]},this))},error:function(){t(document).ready(i.bind(function(){this.fail(n.couldNotLoadData)},this))}}):t(document).ready(i.bind(function(){var e;l.push(this.instanceCount),this.setupInitialData(),this.setupViews();for(e in r["builder"+this.instanceCount])r["builder"+this.instanceCount][e](this);delete r["builder"+this.instanceCount]},this))},error:function(){t(document).ready(i.bind(function(){this.fail(n.couldNotLoadData)},this))}})},this)).fail(i.bind(function(){t(document).ready(i.bind(function(){this.fail(n.couldNotLoadData)},this))},this)):void console.error(n.couldNotInitCanvas)},setupInitialData:function(t){var n,s,o,a,r,d;if(i.contains(l,this.instanceCount))if(t){if(this.form=new e.Builder.FormModel(t),t._embedded.containers&&t._embedded.containers[0]&&(this.form.containers.add(t._embedded.containers[0]),t._embedded.elements&&t._embedded.elements[0])){for(r={},d=0;d<t._embedded.elements[0].length;d++)s=t._embedded.elements[0][d],n=this.form.containers.get(s.container_id),n&&(n.elements.add(s),r[s.id]=s.container_id);if(t._embedded.element_choices&&t._embedded.element_choices[0])for(d=0;d<t._embedded.element_choices[0].length;d++)o=t._embedded.element_choices[0][d],r[o.element_id]&&(n=this.form.containers.get(r[o.element_id]),n&&(s=n.elements.get(o.element_id),s&&s.element_choices.add(o)));if(t._embedded.element_settings&&t._embedded.element_settings[0])for(d=0;d<t._embedded.element_settings[0].length;d++)a=t._embedded.element_settings[0][d],r[a.element_id]&&(n=this.form.containers.get(r[a.element_id]),n&&(s=n.elements.get(a.element_id),s&&s.setElementSetting(a)))}}else this.form=new e.Builder.FormModel({}),this.form.containers.add({})},setupViews:function(){i.contains(l,this.instanceCount)&&(this.formView=new e.Builder.FormView(this.$el,this.form),this.formView.render())},onLoad:function(e){return i.isUndefined(r["builder"+this.instanceCount])?void e(this):void r["builder"+this.instanceCount].push(e)},fail:function(t){var i=e.template("failure");this.$el.find(".drag-drop-area").addClass("is-empty").html(i({message:t}))},on:function(e,t){e="torro."+e,this.$el.on(e,function(){var e=Array.prototype.slice.call(arguments,1);e.length?t.apply(void 0,e):t.apply(void 0,void 0)})},trigger:function(e,t){e="torro."+e,t=t||[],this.$el.trigger(e,t)}}),e.Builder=s,e.Builder.getInstance=function(){return o||(o=new s("#torro-form-canvas"),o.init()),o},e.Builder.AddElement={State:{},View:{}},e.getFieldName=function(t,i){var n;if(t instanceof e.Builder.FormModel?n="forms":t instanceof e.Builder.ContainerModel?n="containers":t instanceof e.Builder.ElementModel?n="elements":t instanceof e.Builder.ElementChoiceModel?n="element_choices":t instanceof e.Builder.ElementSettingModel&&(n="element_settings"),n)return"torro_"+n+"["+t.get("id")+"]["+i+"]"},e.getDeletedFieldName=function(t){var i;if(t instanceof e.Builder.FormModel?i="forms":t instanceof e.Builder.ContainerModel?i="containers":t instanceof e.Builder.ElementModel?i="elements":t instanceof e.Builder.ElementChoiceModel?i="element_choices":t instanceof e.Builder.ElementSettingModel&&(i="element_settings"),i)return"torro_deleted_"+i+"[]"},e.askConfirmation=function(e,i){var s=t("<div />");s.html(e),t("body").append(s),s.dialog({dialogClass:"wp-dialog torro-dialog",modal:!0,autoOpen:!0,closeOnEscape:!0,minHeight:80,buttons:[{text:n.yes,click:function(){i(),t(this).dialog("close"),t(this).remove()}},{text:n.no,click:function(){t(this).dialog("close"),t(this).remove()}}]})},e.Builder.i18n=n}(window.torro,window.jQuery,window._,window.torroBuilderI18n),function(e,t){"use strict";function i(e){this.attributes=e}t.extend(i.prototype,{getSlug:function(){return this.attributes.slug},getTitle:function(){return this.attributes.title},getDescription:function(){return this.attributes.description},getIconCssClass:function(){return this.attributes.icon_css_class},getIconSvgId:function(){return this.attributes.icon_svg_id},getIconUrl:function(){return this.attributes.icon_url},isNonInput:function(){return this.attributes.non_input},isEvaluable:function(){return this.attributes.evaluable},isMultiField:function(){return this.attributes.multifield},getSections:function(){return this.attributes.sections},getFields:function(){return this.attributes.fields}}),e.ElementType=i}(window.torro.Builder,window._),function(e,t){"use strict";function i(e){var t;this.types={};for(t in e)this.types[e[t].getSlug()]=e[t]}t.extend(i.prototype,{get:function(e){if(!t.isUndefined(this.types[e]))return this.types[e]},getAll:function(){return this.types}}),i.fromApiCollection=function(n){var s=[];return n.each(function(i){var n=t.extend({},i.attributes);n._links&&delete n._links,n._embedded&&delete n._embedded,s.push(new e.ElementType(n))}),new i(s)},e.ElementTypes=i}(window.torro.Builder,window._),function(e,t,i,n){"use strict";var s,o=n.media.view.Frame;s=o.extend({className:"media-frame",template:e.template("add-element-frame"),regions:["menu","title","content","toolbar"],events:{"click div.media-frame-title h1":"toggleMenu"},initialize:function(){o.prototype.initialize.apply(this,arguments),t.defaults(this.options,{title:"",buttonLabel:"",modal:!0,collection:[],state:"element-type-library"}),this.$el.addClass("wp-core-ui"),this.options.modal&&(this.modal=new n.media.view.Modal({controller:this,title:this.options.title}),this.modal.content(this)),this.on("attach",t.bind(this.views.ready,this.views),this),this.on("attach",this.showMenu,this),this.createCollection(),this.createStates(),this.bindHandlers(),this.title.mode("default")},render:function(){return!this.state()&&this.options.state&&this.setState(this.options.state),o.prototype.render.apply(this,arguments)},createCollection:function(){var n,s=this.options.collection;s instanceof i.Collection||(n=[],s instanceof e.Builder.ElementTypes?t.each(s.getAll(),function(e){n.push(e.attributes)}):s&&(n=s),this.options.collection=new i.Collection(n))},createStates:function(){this.states.add([new e.Builder.AddElement.State.ElementTypeLibrary({title:this.options.title,collection:this.options.collection,priority:20})])},bindHandlers:function(){this.on("menu:create:default",this.createMenu,this),this.on("title:create:default",this.createTitle,this),this.on("content:create:select-element-type",this.createContent,this),this.on("toolbar:create:insert-element",this.createToolbar,this),this.on("title:render",function(e){e.$el.append('<span class="dashicons dashicons-arrow-down"></span>')})},createMenu:function(e){e.view=new n.media.view.Menu({controller:this})},toggleMenu:function(){this.$el.find(".media-menu").toggleClass("visible")},createTitle:function(e){e.view=new n.media.View({controller:this,tagName:"h1"})},createContent:function(t){t.view=new e.Builder.AddElement.View.ElementTypesBrowser({controller:this,collection:this.options.collection})},createToolbar:function(t){var i=this;t.view=new e.Builder.AddElement.View.InsertElementToolbar({controller:this,items:{insert:{style:"primary",text:this.options.buttonLabel,priority:80,requires:{selected:!0},click:function(){var e=i.state(),t=e.get("selected");i.close(),e.trigger("insert",t).reset()}}}})},showMenu:function(){this.$el.removeClass("hide-menu")}}),t.each(["open","close","attach","detach","escape"],function(e){s.prototype[e]=function(){return this.modal&&this.modal[e].apply(this.modal,arguments),this}}),e.Builder.AddElement.View.Frame=s}(window.torro,window._,window.Backbone,window.wp),function(e,t,i){"use strict";var n,s=i.media.controller.State;n=s.extend({defaults:{id:"element-type-library",title:e.Builder.i18n.selectElementType,menu:"default",content:"select-element-type",toolbar:"insert-element"},initialize:function(){this.get("collection")||this.set("collection",new t.Collection([])),this.set("selected",null)},reset:function(){this.set("selected",null)}}),e.Builder.AddElement.State.ElementTypeLibrary=n}(window.torro,window.Backbone,window.wp),function(e,t,i,n,s){"use strict";var o,a=s.media.View;o=a.extend({tagName:"div",className:"element-types-browser",template:e.template("element-types-browser"),events:{"click .torro-element-type":"setSelected","keyup .torro-element-type":"setSelected"},initialize:function(){a.prototype.initialize.apply(this,arguments),i.defaults(this.options,{collection:[]}),this.options.collection instanceof n.Collection||(this.options.collection=new n.Collection(this.options.collection)),this.controller.state().on("change:selected",this.listenToSelected,this)},prepare:function(){var e={elementTypes:this.options.collection.toJSON(),selectedElementType:this.controller.state().get("selected")};return e},setSelected:function(e){"keyup"===e.type&&32!==e.keyCode||e.currentTarget&&e.currentTarget.dataset.slug&&this.controller.state().set("selected",e.currentTarget.dataset.slug)},listenToSelected:function(e,i){this.$el.find(".torro-element-type").each(function(){var e=t(this);e.toggleClass("is-selected",e.data("slug")===i)})}}),e.Builder.AddElement.View.ElementTypesBrowser=o}(window.torro,window.jQuery,window._,window.Backbone,window.wp),function(e,t,i){"use strict";var n,s=i.media.view.Toolbar;n=s.extend({initialize:function(){i.media.view.Toolbar.prototype.initialize.apply(this,arguments),this.controller.state().on("change:selected",this.refresh,this)},refresh:function(){var e=this.controller.state().get("selected");t.each(this._views,function(t){var i=!1;t.model&&t.options&&t.options.requires&&(!t.options.requires||!t.options.requires.selected||e&&e.length||(i=!0),t.model.set("disabled",i))})}}),e.Builder.AddElement.View.InsertElementToolbar=n}(window.torro,window._,window.wp),function(e,t,i,n){"use strict";e.BaseModel=n.Model.extend({links:{},constructor:function(e,s){var o=e||{},a=this.idAttribute||n.Model.prototype.idAttribute||"id";o._links&&(this.links=o._links),o=i.omit(o,["_links","_embedded"]),o[a]||(o[a]=t.generateTempId()),n.Model.apply(this,[o,s])},sync:function(e,t,n){return"create"===e&&t.has(t.idAttribute)&&(n.attrs||(n.attrs=t.toJSON(n)),n.attrs=i.omit(n.attrs,t.idAttribute)),!1},isNew:function(){return!this.has(this.idAttribute)||t.isTempId(this.get(this.idAttribute))}})}(window.torro.Builder,window.torro,window._,window.Backbone),function(e,t,i,n){"use strict";e.BaseCollection=n.Collection.extend({model:e.BaseModel,defaultProps:{},constructor:function(e,s){var o=i.defaults(s&&s.props||{},this.defaultProps);this.props=new n.Model(o),this.urlEndpoint&&(this.url=t.api.root+t.api.versionString+this.urlEndpoint),n.Collection.apply(this,arguments)},sync:function(){return!1}})}(window.torro.Builder,window.torro,window._,window.Backbone),function(e,t){"use strict";e.ContainerModel=e.BaseModel.extend({defaults:function(){return t.extend(t.clone({id:0,form_id:0,label:"",sort:0}),this.collection.getDefaultAttributes())},elements:void 0,constructor:function(t,i){t=t||{},e.BaseModel.apply(this,[t,i]),this.elements=new e.ElementCollection([],{props:{container_id:this.get("id")},comparator:"sort"})}})}(window.torro.Builder,window._),function(e,t){"use strict";e.ElementChoiceModel=e.BaseModel.extend({defaults:function(){return t.extend(t.clone({id:0,element_id:0,field:"",value:"",sort:0}),this.collection.getDefaultAttributes())}})}(window.torro.Builder,window._),function(e,t){"use strict";e.ElementModel=e.BaseModel.extend({defaults:function(){return t.extend(t.clone({id:0,container_id:0,label:"",sort:0,type:"textfield"}),this.collection.getDefaultAttributes())},element_type:null,element_choices:null,element_settings:void 0,active_section:void 0,constructor:function(t,i){e.BaseModel.apply(this,[t,i]),this.element_choices=new e.ElementChoiceCollection([],{props:{element_id:this.get("id")},comparator:"sort"}),this.element_settings=new e.ElementSettingCollection([],{props:{element_id:this.get("id")}}),this.listenTypeChanged(this,this.get("type")),this.on("change:type",this.listenTypeChanged,this)},setElementSetting:function(e){var t,i;return e.attributes&&(e=e.attributes),!!(t=this.element_settings.findWhere({name:e.name}))&&(i=this.element_settings.indexOf(t),this.element_settings.remove(t),this.element_settings.add(e,{at:i}),!0)},setActiveSection:function(e){e!==this.active_section&&(this.active_section=e,this.trigger("changeActiveSection",this,this.active_section))},getActiveSection:function(){return this.active_section},listenTypeChanged:function(i,n){var s,o,a,l={};i.element_type=e.getInstance().elementTypes.get(n),i.element_type&&(this.trigger("changeElementType",i,i.element_type),s=i.element_type.getSections(),s.length&&i.setActiveSection(s[0].slug),o=i.element_type.getFields().filter(function(e){return!e.is_label&&!e.is_choices}),a=o.map(function(e){return e.slug}),i.element_settings.each(function(e){a.includes(e.name)&&(l[e.name]=e.attributes)}),i.element_settings.reset(),t.each(o,function(e){l[e.slug]?i.element_settings.add(l[e.slug]):i.element_settings.create({name:e.slug,value:e.default||null})}))}})}(window.torro.Builder,window._),function(e,t){"use strict";e.ElementSettingModel=e.BaseModel.extend({defaults:function(){return t.extend(t.clone({id:0,element_id:0,name:"",value:""}),this.collection.getDefaultAttributes())}})}(window.torro.Builder,window._),function(e){"use strict";e.FormModel=e.BaseModel.extend({defaults:{id:0,title:"",slug:"",author:0,status:"draft",timestamp:0,timestamp_modified:0},containers:void 0,constructor:function(t,i){var n;e.BaseModel.apply(this,[t,i]),n={form_id:this.get("id")},this.containers=new e.ContainerCollection([],{props:n,comparator:"sort"})}})}(window.torro.Builder),function(e,t){"use strict";e.ContainerCollection=e.BaseCollection.extend({model:e.ContainerModel,urlEndpoint:"containers",defaultProps:{selected:!1,form_id:0},getDefaultAttributes:function(){var t,i=e.i18n.defaultContainerLabel,n=this.length+1,s=this.length;return this.length&&(t=this.at(this.length-1),t&&(s=t.get("sort")+1,t.get("label")===i.replace("%s",s)&&(n=s+1))),{form_id:this.props.get("form_id"),label:i.replace("%s",n),sort:s}},initialize:function(){this.on("add",t.bind(this.maybeUpdateSelectedOnAdd,this)),this.on("remove",t.bind(this.maybeUpdateSelectedOnRemove,this))},maybeUpdateSelectedOnAdd:function(e){e&&this.props.set("selected",e.get("id"))},maybeUpdateSelectedOnRemove:function(e,t,i){var n=i.index?i.index-1:i.index;e&&this.props.get("selected")===e.get("id")&&(this.length?this.props.set("selected",this.at(n).get("id")):this.props.set("selected",!1))}})}(window.torro.Builder,window._),function(e){"use strict";e.ElementChoiceCollection=e.BaseCollection.extend({model:e.ElementChoiceModel,urlEndpoint:"element_choices",defaultProps:{element_id:0},getDefaultAttributes:function(){return{element_id:this.props.get("element_id"),sort:this.length}}})}(window.torro.Builder),function(e){"use strict";e.ElementCollection=e.BaseCollection.extend({model:e.ElementModel,urlEndpoint:"elements",defaultProps:{active:[],container_id:0},getDefaultAttributes:function(){return{container_id:this.props.get("container_id"),sort:this.length}},toggleActive:function(e){var t=this.props.get("active"),i=t.indexOf(e);i>-1?t.splice(i,1):t.push(e),this.props.set("active",t),this.props.trigger("toggleActive",this,t,{})}})}(window.torro.Builder),function(e){"use strict";e.ElementSettingCollection=e.BaseCollection.extend({model:e.ElementSettingModel,urlEndpoint:"element_settings",defaultProps:{element_id:0},getDefaultAttributes:function(){return{element_id:this.props.get("element_id"),sort:this.length}}})}(window.torro.Builder),function(e){"use strict";e.FormCollection=e.BaseCollection.extend({model:e.FormModel,urlEndpoint:"forms"})}(window.torro.Builder),function(e,t,i){"use strict";function n(i,n){var s=i.get("id"),o=i.get("id")===i.collection.props.get("selected");this.container=i,this.options=n||{},this.tabTemplate=e.template("container-tab"),this.panelTemplate=e.template("container-panel"),this.footerPanelTemplate=e.template("container-footer-panel"),this.$tab=t("<button />"),this.$tab.attr("type","button"),this.$tab.attr("id","container-tab-"+s),this.$tab.addClass("torro-form-canvas-tab"),this.$tab.attr("aria-controls","container-panel-"+s+" container-footer-panel-"+s),this.$tab.attr("aria-selected",o?"true":"false"),this.$tab.attr("role","tab"),this.$panel=t("<div />"),this.$panel.attr("id","container-panel-"+s),this.$panel.addClass("torro-form-canvas-panel"),this.$panel.attr("aria-labelledby","container-tab-"+s),this.$panel.attr("aria-hidden",o?"false":"true"),this.$panel.attr("role","tabpanel"),this.$footerPanel=t("<div />"),this.$footerPanel.attr("id","container-footer-panel-"+s),this.$footerPanel.addClass("torro-form-canvas-panel"),this.$footerPanel.attr("aria-labelledby","container-tab-"+s),this.$footerPanel.attr("aria-hidden",o?"false":"true"),this.$footerPanel.attr("role","tabpanel"),this.addElementFrame=new e.Builder.AddElement.View.Frame({title:e.Builder.i18n.selectElementType,buttonLabel:e.Builder.i18n.insertIntoContainer,collection:e.Builder.getInstance().elementTypes})}i.extend(n.prototype,{render:function(){var e;for(this.$tab.html(this.tabTemplate(this.container.attributes)),this.$panel.html(this.panelTemplate(this.container.attributes)),this.$footerPanel.html(this.footerPanelTemplate(this.container.attributes)),e=0;e<this.container.elements.length;e++)this.listenAddElement(this.container.elements.at(e));this.attach()},destroy:function(){this.detach(),this.$tab.remove(),this.$panel.remove(),this.$footerPanel.remove()},attach:function(){this.container.on("remove",this.listenRemove,this),this.container.elements.on("add",this.listenAddElement,this),this.container.on("change:label",this.listenChangeLabel,this),this.container.on("change:sort",this.listenChangeSort,this),this.container.collection.props.on("change:selected",this.listenChangeSelected,this),this.addElementFrame.on("insert",this.addElement,this),this.$tab.on("click",i.bind(this.setSelected,this)),this.$tab.on("dblclick",i.bind(this.editLabel,this)),this.$panel.on("click",".add-element-toggle",i.bind(this.openAddElementFrame,this)),this.$footerPanel.on("click",".delete-container-button",i.bind(this.deleteContainer,this)),this.$panel.find(".drag-drop-area").sortable({handle:".torro-element-header",items:".torro-element",placeholder:"torro-element-placeholder",tolerance:"pointer",start:function(e,t){t.placeholder.height(t.item.height())},update:i.bind(this.updateElementsSorted,this)})},detach:function(){this.$panel.find("drag-drop-area").sortable("destroy"),this.$footerPanel.off("click",".delete-container-button",i.bind(this.deleteContainer,this)),this.$panel.off("click",".add-element-toggle",i.bind(this.openAddElementFrame,this)),this.$tab.off("dblclick",i.bind(this.editLabel,this)),this.$tab.off("click",i.bind(this.setSelected,this)),this.addElementFrame.off("insert",this.addElement,this),this.container.collection.props.off("change:selected",this.listenChangeSelected,this),this.container.off("change:sort",this.listenChangeSort,this),this.container.off("change:label",this.listenChangeLabel,this),this.container.elements.off("add",this.listenAddContainer,this),this.container.off("remove",this.listenRemove,this)},listenRemove:function(){var i=this.container.get("id");e.isTempId(i)||t("#torro-deleted-wrap").append('<input type="hidden" name="'+e.getDeletedFieldName(this.container)+'" value="'+i+'" />'),this.destroy(),e.Builder.getInstance().trigger("removeContainer",[this.container,this])},listenAddElement:function(t){var i=new e.Builder.ElementView(t,this.options),n=this.$panel.find(".drag-drop-area");n.append(i.$wrap),i.render(),n.sortable("instance")&&n.sortable("refresh"),e.Builder.getInstance().trigger("addElement",[t,i])},listenChangeLabel:function(t,i){var n=e.escapeSelector(e.getFieldName(this.container,"label"));this.$panel.find('input[name="'+n+'"]').val(i)},listenChangeSort:function(t,i){var n=e.escapeSelector(e.getFieldName(this.container,"sort"));this.$panel.find('input[name="'+n+'"]').val(i)},listenChangeSelected:function(e,t){t===this.container.get("id")?(this.$tab.attr("aria-selected","true"),this.$panel.attr("aria-hidden","false"),this.$footerPanel.attr("aria-hidden","false")):(this.$tab.attr("aria-selected","false"),this.$panel.attr("aria-hidden","true"),this.$footerPanel.attr("aria-hidden","true"))},setSelected:function(){this.container.collection.props.set("selected",this.container.get("id"))},editLabel:function(){var e,i=this.container,n=this.$tab.find("span");n.length&&(e=t("<input />"),e.attr("type","text"),e.val(n.text()),e.on("keydown blur",function(t){var s,o=!1;"keydown"===t.type?13===t.which?(o=!0,t.preventDefault()):[32,37,38,39,40].includes(t.which)&&t.stopPropagation():"blur"===t.type?o=!0:t.stopPropagation(),o&&(s=e.val(),i.set("label",s),n.text(s),e.replaceWith(n),n.focus())}),n.replaceWith(e),e.focus())},openAddElementFrame:function(){this.addElementFrame.open()},addElement:function(e){var t;e&&(t=this.container.elements.create({type:e}),this.container.elements.toggleActive(t.get("id")))},deleteContainer:function(){e.askConfirmation(e.Builder.i18n.confirmDeleteContainer,i.bind(function(){this.container.collection.remove(this.container)},this))},updateElementsSorted:function(e,i){var n=this.container;i.item.parent().find(".torro-element").each(function(e){var i=t(this),s=n.elements.get(i.attr("id").replace("torro-element-",""));s.set("sort",e)}),n.elements.sort()}}),e.Builder.ContainerView=n}(window.torro,window.jQuery,window._),function(e,t,i,n,s){"use strict";function o(e){var t=i.clone(e);return i.each(t,function(e,n){var s,a;if(i.isArray(e)){for(s=[],a=0;a<e.length;a++)i.isObject(e[a])?s.push(o(e[a])):s.push(e[a]);t[n]=s}else i.isObject(e)&&(t[n]=o(e))}),t}function a(e){var t={};return i.each(e,function(e,n){i.isObject(e)&&!i.isArray(e)?(e=a(e),i.isEmpty(e)||(t[n]=e)):i.isString(e)&&e.match(/%([A-Za-z0-9]+)%/g)&&(t[n]=e)}),t}function l(e,t,n){function s(e,n){return i.isUndefined(t[n])?e:t[n]}i.isUndefined(n)&&(n=a(e)),i.each(n,function(n,o){i.isObject(n)?(i.isObject(e[o])||(e[o]={}),l(e[o],t,n)):e[o]=n.replace(/%([A-Za-z0-9]+)%/g,s)})}function r(e,t){var n=i.deepClone(e);return l(n,{index:t,indexPlus1:t+1}),n}function d(e,t){return"torro_element_"+e.get("id")+"_"+t}function c(t,n){var a=[],l=!1;return i.each(t,function(t){var c,h,u,m;if(!i.isUndefined(t.type)&&!i.isUndefined(s.fields["dummy_"+t.type])){if(c=o(s.fields["dummy_"+t.type]),c.section=t.section,c.label=t.label,c.description=t.description,c.default=t.default||null,t.is_choices)h=n.element_choices.where({field:i.isString(t.is_choices)?t.is_choices:"_main"}),m=e.generateTempId(),c.repeatable=!0,c.repeatableLimit=0,c.id=d(n,t.slug),c.labelAttrs.id=c.id+"-label",c.itemInitial.currentValue=c.default,c.itemInitial.default=c.default,c.itemInitial.element_id=n.get("id"),c.itemInitial.field=i.isString(t.is_choices)?t.is_choices:"_main",c.itemInitial.id=c.id+"-%indexPlus1%",c.itemInitial.label=e.Builder.i18n.elementChoiceLabel.replace("%s","%indexPlus1%"),c.itemInitial.name="torro_element_choices["+m+"_%index%][value]",c.itemInitial.section=c.section,c.itemInitial.sort="%index%",c.itemInitial.inputAttrs.id=c.itemInitial.id,c.itemInitial.inputAttrs.name=c.itemInitial.name,i.isArray(t.input_classes)&&(c.itemInitial.inputAttrs.class+=" "+t.input_classes.join(" ")),c.itemInitial.labelAttrs.id=c.itemInitial.id+"-label",c.itemInitial.labelAttrs.for=c.itemInitial.id,c.itemInitial.wrapAttrs.id=c.itemInitial.id+"-wrap",c.wrapAttrs=o(c.itemInitial.wrapAttrs),c.wrapAttrs.id=c.id+"-wrap",i.each(h,function(t,i){var n=r(c.itemInitial,i);n.name=e.getFieldName(t,"value"),n.inputAttrs.name=n.name,n.currentValue=t.get("value"),c.items.push(n)});else{if(t.repeatable)return;if(t.is_label){if(l)return;l=!0,c.id=d(n,"label"),c.name=e.getFieldName(n,"label"),c.currentValue=n.get("label")}else{if(u=n.element_settings.findWhere({name:t.slug}),!u)return;c.id=d(n,u.get("id")),c.name=e.getFieldName(u,"value"),c.currentValue=u.get("value"),c._element_setting=i.clone(u.attributes),c.inputAttrs["data-element-setting-id"]=u.get("id")}switch(c.slug){case"autocomplete":i.isUndefined(t.autocomplete)||(c.autocomplete=o(t.autocomplete));break;case"color":c.inputAttrs.maxlength=7;break;case"datetime":i.isUndefined(t.store)||(c.store=t.store,c.inputAttrs["data-store"]=t.store),i.isUndefined(t.min)||(c.inputAttrs.min=t.min),i.isUndefined(t.max)||(c.inputAttrs.max=t.max);break;case"map":case"media":i.isUndefined(t.store)||(c.store=t.store,c.inputAttrs["data-store"]=t.store);break;case"number":case"range":i.isUndefined(t.min)||(c.inputAttrs.min=t.min),i.isUndefined(t.max)||(c.inputAttrs.max=t.max),i.isUndefined(t.step)||(c.inputAttrs.step=t.step),i.isUndefined(t.unit)||(c.unit=t.unit);break;case"radio":case"multibox":case"select":case"multiselect":i.isUndefined(t.choices)?c.choices={}:c.choices=o(t.choices);break;case"text":i.isUndefined(t.maxlength)||(c.inputAttrs.maxlength=t.maxlength),i.isUndefined(t.pattern)||(c.inputAttrs.pattern=t.pattern);break;case"textarea":i.isUndefined(t.rows)||(c.inputAttrs.rows=t.rows);break;case"wysiwyg":i.isUndefined(t.wpautop)||(c.wpautop=t.wpautop,c.inputAttrs["data-wpautop"]=t.wpautop),i.isUndefined(t.media_buttons)||(c.media_buttons=t.media_buttons,c.inputAttrs["data-media-buttons"]=t.media_buttons),i.isUndefined(t.button_mode)||(c.button_mode=t.button_mode,c.inputAttrs["data-button-mode"]=t.button_mode)}if(null===c.currentValue)switch(c.slug){case"media":"url"===c.store?c.currentValue="":c.currentValue=0;break;case"number":case"range":i.isUndefined(c.inputAttrs.min)?c.currentValue=0:c.currentValue=c.inputAttrs.min;break;case"multibox":case"multiselect":c.currentValue=[];break;default:c.currentValue=""}c.inputAttrs.id=c.id,c.inputAttrs.name=c.name,i.isArray(t.input_classes)&&(c.inputAttrs.class+=" "+t.input_classes.join(" ")),c.description.length&&(c.inputAttrs["aria-describedby"]=c.id+"-description"),c.labelAttrs.id=c.id+"-label",c.labelAttrs.for=c.id,c.wrapAttrs.id=c.id+"-wrap"}a.push(c)}}),a}function h(e){var t;return e.length&&-1!==e.search("<")&&(t=document.createElement("div"),t.innerHTML=e,e=t.textContent.trim()),e.length>50&&(e=e.substring(0,47)+"..."),e}function u(i,n){var s=i.get("id");this.element=i,this.options=n||{},this.wrapTemplate=e.template("element"),this.sectionTabTemplate=e.template("element-section-tab"),this.sectionPanelTemplate=e.template("element-section-panel"),this.fieldTemplate=e.template("element-field"),this.$wrap=t("<div />"),this.$wrap.attr("id","torro-element-"+s),this.$wrap.addClass("torro-element")}i.extend(u.prototype,{render:function(){var e=this.element.attributes;e.elementHeader=e.label?h(e.label):"",e.type=this.element.element_type.attributes,e.active=this.element.collection.props.get("active").includes(this.element.get("id")),e.active_section=this.element.getActiveSection(),this.$wrap.html(this.wrapTemplate(e)),this.initializeSections(),this.initializeFields(),this.attach()},destroy:function(){this.detach(),this.deinitializeFields(),this.deinitializeSections(),this.$wrap.remove()},initializeSections:function(){var e=this.$wrap.find(".torro-element-content-tabs"),t=this.$wrap.find(".torro-element-content-panels"),n=this.element.element_type.getSections(),s=this.element;i.each(n,i.bind(function(n){var o=i.clone(n);o.elementId=s.get("id"),o.active=s.getActiveSection()===o.slug,e.append(this.sectionTabTemplate(o)),t.append(this.sectionPanelTemplate(o))},this))},deinitializeSections:function(){var e=this.$wrap.find(".torro-element-content-tabs"),t=this.$wrap.find(".torro-element-content-panels");e.empty(),t.empty()},initializeFields:function(){this.fieldManager=new n.FieldManager(c(this.element.element_type.getFields(),this.element),{instanceId:"torro_element_"+this.element.get("id")}),this.fieldViews=[],i.each(this.fieldManager.models,i.bind(function(e){var t,i=e.get("backboneView"),s=n.FieldView,o=this.$wrap.find("#element-panel-"+this.element.get("id")+"-"+e.get("section")+" > .torro-element-fields");o.length&&(o.append(this.fieldTemplate(e.attributes)),i&&"FieldView"!==i&&n.FieldView[i]&&(s=n.FieldView[i]),t=new s({model:e}),t.renderLabel(),t.renderContent(),this.fieldViews.push(t))},this))},deinitializeFields:function(){i.each(this.fieldViews,function(e){e.remove()}),this.$wrap.find(".torro-element-fields").each(function(){t(this).empty()}),this.fieldViews=[],this.fieldManager=null},attach:function(){var e=i.bind(this.updateElementChoicesSorted,this);this.element.on("remove",this.listenRemove,this),this.element.on("change:label",this.listenChangeLabel,this),this.element.on("change:type",this.listenChangeType,this),this.element.on("change:sort",this.listenChangeSort,this),this.element.on("changeElementType",this.listenChangeElementType,this),this.element.on("changeActiveSection",this.listenChangeActiveSection,this),this.element.collection.props.on("toggleActive",this.listenChangeActive,this),i.each(this.fieldViews,i.bind(function(e){e.model.get("_element_setting")?e.model.on("changeValue",i.bind(this.listenChangeElementSettingFieldValue,this)):"torrochoices"===e.model.get("slug")&&(e.model.on("addItem",i.bind(this.listenAddElementChoiceField,this)),e.model.on("removeItem",i.bind(this.listenRemoveElementChoiceField,this)),e.model.on("changeItemValue",i.bind(this.listenChangeElementChoiceFieldValue,this)))},this)),this.$wrap.on("click",".torro-element-header",i.bind(this.toggleActive,this)),this.$wrap.on("click",".torro-element-expand-button",i.bind(this.toggleActive,this)),this.$wrap.on("click",".delete-element-button",i.bind(this.deleteElement,this)),this.$wrap.on("click",".torro-element-content-tab",i.bind(this.changeActiveSection,this)),this.$wrap.on("keyup change",'input[type="text"]#'+d(this.element,"label"),i.bind(this.updateLabel,this)),this.$wrap.find(".plugin-lib-repeatable-torrochoices-wrap").each(function(){t(this).sortable({containment:"parent",handle:".torro-element-choice-move",items:".plugin-lib-repeatable-item",placeholder:"torro-element-choice-placeholder",tolerance:"pointer",update:e})})},detach:function(){this.$wrap.find(".plugin-lib-repeatable-torrochoices-wrap").each(function(){t(this).sortable("destroy")}),this.$wrap.off("keyup change",'input[type="text"]#'+d(this.element,"label"),i.bind(this.updateLabel,this)),this.$wrap.off("click",".torro-element-content-tab",i.bind(this.changeActiveSection,this)),this.$wrap.off("click",".delete-element-button",i.bind(this.deleteElement,this)),this.$wrap.off("click",".torro-element-expand-button",i.bind(this.toggleActive,this)),this.$wrap.off("click",".torro-element-header",i.bind(this.toggleActive,this)),i.each(this.fieldViews,i.bind(function(e){e.model.get("_element_setting")?e.model.off("changeValue",i.bind(this.listenChangeElementSettingFieldValue,this)):"torrochoices"===e.model.get("slug")&&(e.model.off("addItem",i.bind(this.listenAddElementChoiceField,this)),e.model.off("removeItem",i.bind(this.listenRemoveElementChoiceField,this)),e.model.off("changeItemValue",i.bind(this.listenChangeElementChoiceFieldValue,this)))},this)),this.element.collection.props.off("toggleActive",this.listenChangeActive,this),this.element.off("changeActiveSection",this.listenChangeActiveSection,this),this.element.off("changeElementType",this.listenChangeElementType,this),this.element.off("change:sort",this.listenChangeSort,this),
this.element.off("change:type",this.listenChangeType,this),this.element.off("change:label",this.listenChangeLabel,this),this.element.off("remove",this.listenRemove,this)},listenRemove:function(){var i=this.element.get("id");e.isTempId(i)||t("#torro-deleted-wrap").append('<input type="hidden" name="'+e.getDeletedFieldName(this.element)+'" value="'+i+'" />'),this.destroy(),e.Builder.getInstance().trigger("removeElement",[this.element,this])},listenChangeLabel:function(t,i){var n=e.escapeSelector(e.getFieldName(this.element,"label")),s=i;return this.$wrap.find('input[name="'+n+'"]').val(i),s&&(s=h(s),s.length)?void this.$wrap.find(".torro-element-header-title").text(s):void this.$wrap.find(".torro-element-header-title").text(this.element.element_type.getTitle())},listenChangeType:function(t,i){var n=e.escapeSelector(e.getFieldName(this.element,"type"));this.$wrap.find('input[name="'+n+'"]').val(i)},listenChangeSort:function(t,i){var n=e.escapeSelector(e.getFieldName(this.element,"sort"));this.$wrap.find('input[name="'+n+'"]').val(i)},listenChangeElementType:function(){this.deinitializeFields(),this.deinitializeSections(),this.initializeSections(),this.initializeFields()},listenChangeActiveSection:function(e,t){var i=this.$wrap.find('.torro-element-content-tab[data-slug="'+t+'"]');this.$wrap.find(".torro-element-content-tab").attr("aria-selected","false"),this.$wrap.find(".torro-element-content-panel").attr("aria-hidden","true"),i.length&&(i.attr("aria-selected","true"),this.$wrap.find("#"+i.attr("aria-controls")).attr("aria-hidden","false"))},listenChangeActive:function(i,n){n.includes(this.element.get("id"))?(this.$wrap.find(".torro-element-expand-button").attr("aria-expanded","true").find(".screen-reader-text").text(e.Builder.i18n.hideContent),this.$wrap.find(".torro-element-content").addClass("is-expanded")):(this.$wrap.find(".torro-element-expand-button").attr("aria-expanded","false").find(".screen-reader-text").text(e.Builder.i18n.showContent),this.$wrap.find(".torro-element-content").removeClass("is-expanded")),this.$wrap.find(".plugin-lib-repeatable-torrochoices-wrap").each(function(){var e=t(this);e.sortable("instance")&&e.sortable("refresh")})},listenChangeElementSettingFieldValue:function(e,t){var i=e.get("_element_setting").id,n=this.element.element_settings.get(i);n&&n.set("value",t)},listenAddElementChoiceField:function(e,i){var n=i.name.replace("torro_element_choices[","").replace("][value]",""),s=t("#torro_element_"+this.element.get("id")+"_choices_"+i.field+"-repeatable-wrap");this.element.element_choices.create({id:n,field:i.field}),s.sortable("instance")&&s.sortable("refresh")},listenRemoveElementChoiceField:function(i,n){var s=n.name.replace("torro_element_choices[","").replace("][value]",""),o=this.element.element_choices.get(s);this.element.element_choices.remove(s),e.isTempId(s)||t("#torro-deleted-wrap").append('<input type="hidden" name="'+e.getDeletedFieldName(o)+'" value="'+s+'" />')},listenChangeElementChoiceFieldValue:function(e,t,i){var n=t.name.replace("torro_element_choices[","").replace("][value]",""),s=this.element.element_choices.get(n);s.set("value",i)},toggleActive:function(e){e.stopPropagation(),this.element.collection.toggleActive(this.element.get("id"))},deleteElement:function(){e.askConfirmation(e.Builder.i18n.confirmDeleteElement,i.bind(function(){this.element.collection.remove(this.element)},this))},changeActiveSection:function(e){var i=t(e.target||e.delegateTarget);this.element.setActiveSection(i.data("slug"))},updateLabel:function(e){var i=t(e.target||e.delegateTarget);this.element.set("label",i.val())},updateElementChoicesSorted:function(i,n){var s=this.element;n.item.parent().find(".plugin-lib-repeatable-item").each(function(i){var n=t(this).find('input[type="text"]').attr("name").replace("torro_element_choices[","").replace("][value]",""),o=s.element_choices.get(n);o.set("sort",i),t(this).find('input[name="'+e.escapeSelector("torro_element_choices["+n+"][sort]")+'"]').val(i)}),s.element_choices.sort()}}),e.Builder.ElementView=u}(window.torro,window.jQuery,window._,window.pluginLibFieldsAPI,window.pluginLibFieldsAPIData.field_managers.torro_dummy_1),function(e,t,i){"use strict";function n(t,i,n){this.form=i,this.options=n||{},this.canvasTemplate=e.template("form-canvas"),this.$canvas=t}i.extend(n.prototype,{render:function(){var e,i;for(e=t("<div />"),e.attr("id","torro-deleted-wrap"),e.css("display","none"),this.$canvas.html(this.canvasTemplate(this.form.attributes)),this.$canvas.after(e),this.$addButton=this.$canvas.find(".add-button"),this.$addPanel=this.$canvas.find(".add-panel"),this.checkHasContainers(),i=0;i<this.form.containers.length;i++)this.listenAddContainer(this.form.containers.at(i));this.attach()},destroy:function(){this.detach(),this.$canvas.empty()},attach:function(){this.form.containers.on("add",this.listenAddContainer,this),this.form.containers.on("add remove reset",this.checkHasContainers,this),this.$addButton.on("click",i.bind(this.addContainer,this))},detach:function(){this.$addButton.off("click",i.bind(this.addContainer,this)),this.form.containers.off("add remove reset",i.bind(this.checkHasContainers,this)),this.form.containers.off("add",this.listenAddContainer,this)},listenAddContainer:function(t){var i=new e.Builder.ContainerView(t,this.options);i.$tab.insertBefore(this.$addButton),i.$panel.insertBefore(this.$addPanel),this.$canvas.find(".torro-form-canvas-footer").append(i.$footerPanel),i.render(),e.Builder.getInstance().trigger("addContainer",[t,i])},checkHasContainers:function(){this.form.containers.length?(this.$addButton.removeClass("is-active"),this.$addPanel.attr("aria-hidden","true")):(this.$addButton.addClass("is-active"),this.$addPanel.attr("aria-hidden","false"))},addContainer:function(){this.form.containers.create()}}),e.Builder.FormView=n}(window.torro,window.jQuery,window._),function(e){"use strict";e(".torro-metabox-tab").on("click",function(t){var i=e(this),n=i.parent().children(".torro-metabox-tab");t.preventDefault(),"true"!==i.attr("aria-selected")&&(n.each(function(){e(this).attr("aria-selected","false"),e(e(this).attr("href")).attr("aria-hidden","true")}),i.attr("aria-selected","true"),e(i.attr("href")).attr("aria-hidden","false").find(".plugin-lib-map-control").each(function(){e(this).wpMapPicker("refresh")}))})}(window.jQuery),function(e){"use strict";e.getInstance()}(window.torro.Builder);